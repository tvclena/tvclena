<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Clena Analytics</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:Inter,Arial,sans-serif;
  background:#0f0f10;
  color:#fff;
}

/* ================= HEADER ================= */
header{
  height:72px;
  padding:0 32px;
  display:flex;
  align-items:center;
  gap:18px;
  background:#000;
  border-bottom:1px solid #222;
}
header img{
  height:38px;
}
header h1{
  font-size:20px;
  font-weight:700;
}
header span{
  color:#aaa;
  font-size:13px;
}

/* ================= LAYOUT ================= */
main{
  padding:28px 32px;
}

/* ================= KPIs ================= */
.kpis{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:16px;
  margin-bottom:36px;
}
.kpi{
  background:#151515;
  border-radius:14px;
  padding:18px;
  border:1px solid #222;
}
.kpi h3{
  font-size:13px;
  color:#aaa;
  margin-bottom:6px;
}
.kpi strong{
  font-size:28px;
  font-weight:700;
  color:#fff;
}
.kpi span{
  font-size:12px;
  color:#00ff99;
}

/* ================= SECTIONS ================= */
.section{
  margin-bottom:40px;
}
.section h2{
  font-size:18px;
  margin-bottom:16px;
}

/* ================= GRID ================= */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:16px;
}
.card{
  background:#1c1c1c;
  border-radius:14px;
  overflow:hidden;
  border:1px solid #222;
}
.card img{
  width:100%;
  height:240px;
  object-fit:cover;
}
.card .info{
  padding:12px;
}
.card .info strong{
  display:block;
  font-size:14px;
}
.card .info small{
  color:#aaa;
  font-size:12px;
}

/* ================= LIST ================= */
.list{
  background:#151515;
  border-radius:14px;
  border:1px solid #222;
  overflow:hidden;
}
.row{
  display:grid;
  grid-template-columns:1.4fr .6fr .6fr;
  padding:12px 16px;
  border-bottom:1px solid #222;
  font-size:13px;
}
.row:last-child{border-bottom:none}
.row span{color:#aaa}

/* ================= STATUS ================= */
.online{color:#00ff99;font-weight:600}
.offline{color:#aaa}

/* ================= FOOTER ================= */
footer{
  text-align:center;
  padding:20px;
  color:#666;
  font-size:12px;
}
</style>
</head>

<body>

<header>
  <img src="/logo1.png" alt="Clena">
  <h1>Clena Analytics</h1>
  <span>Painel de acompanhamento em tempo real</span>
</header>

<main>

  <!-- ================= KPIs ================= -->
  <div class="kpis">
    <div class="kpi">
      <h3>üë• Usu√°rios cadastrados</h3>
      <strong id="kpiUsuarios">0</strong>
    </div>
    <div class="kpi">
      <h3>üé¨ Filmes / S√©ries</h3>
      <strong id="kpiFilmes">0</strong>
    </div>
    <div class="kpi">
      <h3>‚ñ∂Ô∏è Sess√µes de play</h3>
      <strong id="kpiSessoes">0</strong>
    </div>
    <div class="kpi">
      <h3>üü¢ Online (√∫ltimos 5 min)</h3>
      <strong id="kpiOnline">0</strong>
      <span>atividade recente</span>
    </div>
  </div>

  <!-- ================= FILMES ================= -->
  <div class="section">
    <h2>üé¨ Conte√∫dos cadastrados</h2>
    <div class="grid" id="gridFilmes"></div>
  </div>

  <!-- ================= USU√ÅRIOS ================= -->
  <div class="section">
    <h2>üë• Usu√°rios</h2>
    <div class="list" id="listaUsuarios"></div>
  </div>

  <!-- ================= ASSISTINDO AGORA ================= -->
  <div class="section">
    <h2>‚ñ∂Ô∏è Assistindo agora</h2>
    <div class="list" id="assistindoAgora"></div>
  </div>

</main>

<footer>
  Clena Analytics ‚Ä¢ Dados em tempo real ‚Ä¢ ¬© 2025
</footer>

<script>
/* ================= SUPABASE ================= */
const sb = supabase.createClient(
  "https://dxkszikemntfusfyrzos.supabase.co",
  "sb_publishable_NNFvdfSXgOdGGVcSbphbjQ_brC3_9ed"
);

/* ================= LOAD DASHBOARD ================= */
async function carregarDashboard(){

  /* ---------- KPIs ---------- */
  const [{ count: usuarios },{ count: filmes },{ count: sessoes }] =
    await Promise.all([
      sb.from("usuarios").select("*",{count:"exact",head:true}),
      sb.from("filmes").select("*",{count:"exact",head:true}),
      sb.from("watch_sessions").select("*",{count:"exact",head:true})
    ]);

  document.getElementById("kpiUsuarios").textContent = usuarios || 0;
  document.getElementById("kpiFilmes").textContent = filmes || 0;
  document.getElementById("kpiSessoes").textContent = sessoes || 0;

  /* ---------- ONLINE ---------- */
  const { data: online } = await sb
    .from("vw_assistindo_agora")
    .select("*");

  document.getElementById("kpiOnline").textContent =
    online?.length || 0;

  /* ---------- FILMES ---------- */
  const { data: listaFilmes } = await sb
    .from("filmes")
    .select("id,titulo,serie_nome,capa_url,tipo")
    .order("created_at",{ascending:false})
    .limit(12);

  document.getElementById("gridFilmes").innerHTML =
    (listaFilmes || []).map(f=>`
      <div class="card">
        <img src="${f.capa_url}">
        <div class="info">
          <strong>${f.titulo || f.serie_nome}</strong>
          <small>${f.tipo}</small>
        </div>
      </div>
    `).join("");

  /* ---------- USU√ÅRIOS ---------- */
  const { data: usuariosLista } = await sb
    .from("usuarios")
    .select("email,status,created_at")
    .order("created_at",{ascending:false})
    .limit(10);

  document.getElementById("listaUsuarios").innerHTML =
    (usuariosLista || []).map(u=>`
      <div class="row">
        <div>${u.email}</div>
        <span>${u.status}</span>
        <span>${new Date(u.created_at).toLocaleDateString()}</span>
      </div>
    `).join("");

  /* ---------- ASSISTINDO AGORA ---------- */
  document.getElementById("assistindoAgora").innerHTML =
    (online || []).map(o=>`
      <div class="row">
        <div>${o.email}</div>
        <span>${o.titulo || o.serie_nome}</span>
        <span class="online">online</span>
      </div>
    `).join("");
}

carregarDashboard();
setInterval(carregarDashboard, 15000);
</script>

</body>
</html>
