<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Entrar • CLENA TV</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{box-sizing:border-box;font-family:Inter,system-ui,Arial}
html,body{
  margin:0;width:100%;height:100%;
  overflow:hidden;background:#0b0b0d;color:#fff
}

:root{
  --card:#141417;
  --accent:#e50914;
  --muted:#9ca3af;
  --border:#242428;
  --input:#0f0f13;
}

body{
  display:flex;
  align-items:center;
  justify-content:center;
  background:radial-gradient(80% 60% at 50% 20%, #1b1b20 0%, #0b0b0d 70%);
}

.card{
  width:420px;
  max-width:92%;
  background:linear-gradient(180deg,#16161b,#101013);
  border-radius:22px;
  padding:40px 36px;
  box-shadow:0 40px 120px rgba(0,0,0,.9);
}

.logo{text-align:center;font-size:34px;font-weight:900;margin-bottom:30px}
.logo span{color:var(--accent)}

.group{margin-bottom:16px}
label{font-size:13px;color:var(--muted);margin-bottom:6px;display:block}
input{
  width:100%;padding:14px 16px;border-radius:12px;
  border:1px solid var(--border);
  background:var(--input);color:#fff;font-size:15px
}

.btn{
  width:100%;height:52px;border:none;border-radius:14px;
  font-size:16px;font-weight:800;cursor:pointer
}
.btn-primary{background:var(--accent);color:#fff}

.google-btn{
  margin:16px auto 0;width:52px;height:52px;border-radius:50%;
  background:#0f0f13;border:1px solid #242428;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer
}
.google-btn img{width:32px;height:32px}

.footer{display:flex;justify-content:space-between;margin-top:22px;font-size:13px}
.footer a{color:#c7c7cc;text-decoration:none}

.msg{margin-top:14px;min-height:18px;font-size:14px}
.msg.error{color:#f87171}
.msg.success{color:#22c55e}

.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.85);
  display:none;align-items:center;justify-content:center;z-index:9999
}

/* PRIVACIDADE */
.privacidade-popup{
  width:90%;max-width:760px;height:80vh;
  background:#141417;border-radius:22px;
  position:relative;overflow:hidden
}
.privacidade-fechar{
  position:absolute;top:14px;right:16px;
  width:36px;height:36px;border:none;border-radius:50%;
  background:#1f1f23;color:#fff;font-size:18px;cursor:pointer
}
.privacidade-conteudo{
  height:100%;padding:28px;overflow-y:auto
}
.privacidade-conteudo::-webkit-scrollbar{width:0}
.privacidade-conteudo{scrollbar-width:none}

.privacidade-box{
  display:flex;align-items:center;gap:10px;margin-top:14px;font-size:13px
}
.privacidade-box input{width:18px;height:18px;accent-color:#e50914}
.privacidade-box a{color:#3ea6ff;text-decoration:none}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="card">
  <div class="logo">CLENA <span>TV</span></div>

  <div class="group"><label>Email</label><input id="email"></div>
  <div class="group"><label>Senha</label><input id="senha" type="password"></div>

  <button id="btnLogin" class="btn btn-primary">Entrar</button>

  <div id="btnGoogle" class="google-btn">
    <img src="google.png">
  </div>

  <div class="footer">
    <a id="abrirCadastro">Criar conta</a>
    <a id="btnReset">Esqueci a senha</a>
  </div>

  <div class="msg" id="msg"></div>
</div>

<!-- CADASTRO -->
<div class="modal" id="modalCadastro">
  <div class="card">
    <h2>Criar conta</h2>

    <div class="group"><label>Email</label><input id="c_email"></div>

    <div class="group">
      <label>CPF</label>
      <input id="c_cpf" inputmode="numeric" placeholder="000.000.000-00">
    </div>

    <div class="group">
      <label>WhatsApp</label>
      <input id="c_whats" inputmode="numeric" placeholder="(99) 99999-9999">
    </div>

    <div class="group"><label>Senha</label><input id="c_senha" type="password"></div>
    <div class="group"><label>Confirmar senha</label><input id="c_confirma" type="password"></div>

    <div class="privacidade-box">
      <input type="checkbox" id="aceitePrivacidade">
      <label>Aceito as <a onclick="abrirPrivacidade()">Políticas de Privacidade</a></label>
    </div>

    <button id="btnCadastro" class="btn btn-primary">Cadastrar</button>
    <div class="footer"><a id="fecharCadastro">Cancelar</a></div>
    <div class="msg" id="msgCadastro"></div>
  </div>
</div>

<!-- PRIVACIDADE -->
<div class="modal" id="modalPrivacidade">
  <div class="privacidade-popup">
    <button class="privacidade-fechar" onclick="fecharPrivacidade()">✕</button>
    <div class="privacidade-conteudo" id="conteudoPrivacidade"></div>
  </div>
</div>

<script>
const sb = supabase.createClient(
  "https://dxkszikemntfusfyrzos.supabase.co",
  "sb_publishable_NNFvdfSXgOdGGVcSbphbjQ_brC3_9ed"
);

/* EMAIL */
const emailRegex=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@([a-zA-Z0-9-]+\.)+[a-zA-Z]{2,}$/;
const emailValido=e=>emailRegex.test(e);

/* PRIVACIDADE */
function abrirPrivacidade(){
  fetch("privacidade.html")
    .then(r=>r.text())
    .then(t=>{
      conteudoPrivacidade.innerHTML=t;
      modalPrivacidade.style.display="flex";
    });
}
function fecharPrivacidade(){modalPrivacidade.style.display="none";}

abrirCadastro.onclick=()=>modalCadastro.style.display="flex";
fecharCadastro.onclick=()=>modalCadastro.style.display="none";

/* MÁSCARAS */
c_cpf.addEventListener("input",e=>{
  let v=e.target.value.replace(/\D/g,"").slice(0,11);
  v=v.replace(/(\d{3})(\d)/,"$1.$2")
     .replace(/(\d{3})\.(\d{3})(\d)/,"$1.$2.$3")
     .replace(/(\d{3})\.(\d{3})\.(\d{3})(\d{1,2})/,"$1.$2.$3-$4");
  e.target.value=v;
});
c_whats.addEventListener("input",e=>{
  let v=e.target.value.replace(/\D/g,"").slice(0,11);
  v=v.replace(/(\d{2})(\d)/,"($1) $2")
     .replace(/(\d{5})(\d)/,"$1-$2");
  e.target.value=v;
});

/* CADASTRO */
btnCadastro.onclick=async()=>{
  if(!emailValido(c_email.value)){
    msgCadastro.textContent="Email inválido";
    msgCadastro.className="msg error";return;
  }
  if(!aceitePrivacidade.checked){
    msgCadastro.textContent="Aceite as políticas de privacidade";
    msgCadastro.className="msg error";return;
  }
  if(c_senha.value!==c_confirma.value){
    msgCadastro.textContent="Senhas não conferem";
    msgCadastro.className="msg error";return;
  }

  const {error}=await sb.auth.signUp({
    email:c_email.value,
    password:c_senha.value
  });

  if(error){
    msgCadastro.textContent=error.message;
    msgCadastro.className="msg error";return;
  }

  msgCadastro.textContent="Conta criada com sucesso!";
  msgCadastro.className="msg success";

  setTimeout(()=>{
    modalCadastro.style.display="none";
  },1200);
};

/* LOGIN */
btnLogin.onclick=async()=>{
  if(!emailValido(email.value)){
    msg.textContent="Email inválido";
    msg.className="msg error";return;
  }
  const {data,error}=await sb.auth.signInWithPassword({
    email:email.value,password:senha.value
  });
  if(error||!data.session){
    msg.textContent="Email ou senha inválidos";
    msg.className="msg error";return;
  }
  location.replace("index.html");
};

btnGoogle.onclick=()=>sb.auth.signInWithOAuth({provider:"google"});
btnReset.onclick=()=>email.value&&sb.auth.resetPasswordForEmail(email.value);
</script>

</body>
</html>
